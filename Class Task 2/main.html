<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archery Game - JS Task</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="game-container">
        <div id="ui-layer">
            <div class="hud-box">Score: <span id="score">0</span></div>
            <div class="hud-box">Time: <span id="time">60</span>s</div>
        </div>

        <div id="bow"></div>
        <div id="arrow"></div>
        <div id="target"></div>

        <div class="ground"></div>

        <div id="game-over-modal">
            <h1>Game Over!</h1>
            <h2>Final Score: <span id="final-score">0</span></h2>
            <button id="restart-btn">Play Again</button>
        </div>
    </div>

    <script>
        const uiScore = document.querySelector('#score');
        const uiTime = document.querySelector('#time');
        const arrow = document.querySelector('#arrow');
        const target = document.querySelector('#target');
        const gameContainer = document.querySelector('#game-container');
        const modal = document.querySelector('#game-over-modal');
        const finalScoreDisplay = document.querySelector('#final-score');
        const restartBtn = document.querySelector('#restart-btn');

        let score = 0;
        let timeLeft = 60;
        let isGameOver = false;
        let isShooting = false;
        let timerInterval = null;
        let targetMovementInterval = null;
        let animationFrameId = null;

        // Configuration
        const INITIAL_ARROW_LEFT = 55; // Matches CSS
        const GAME_WIDTH = window.innerWidth;
        const GAME_HEIGHT = window.innerHeight;
        
        let targetSpeed = 3; 
        let targetDirection = 1; // 1 = down, -1 = up

        const startTimer = () => {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    uiTime.textContent = timeLeft;
                } else {
                    endGame();
                }
            }, 1000);
        };

        const moveTarget = () => {
            let currentTop = parseInt(window.getComputedStyle(target).top);
            
            if (currentTop >= (GAME_HEIGHT - 200)) {
                targetDirection = -1;
            } else if (currentTop <= 50) {
                targetDirection = 1;
            }

            target.style.top = `${currentTop + (targetSpeed * targetDirection)}px`;
            
            if (!isGameOver) {
                targetMovementInterval = requestAnimationFrame(moveTarget);
            }
        };

        const shootArrow = () => {
            if (isShooting || isGameOver) return;
            
            isShooting = true;
            let arrowPos = INITIAL_ARROW_LEFT;

            const flyArrow = () => {
                if (!isShooting) return;

                arrowPos += 15;
                arrow.style.left = `${arrowPos}px`;

                if (checkCollision(arrow, target)) {
                    handleHit();
                    return; 
                }

                if (arrowPos > GAME_WIDTH) {
                    resetArrow();
                } else {
                    animationFrameId = requestAnimationFrame(flyArrow);
                }
            };
            
            requestAnimationFrame(flyArrow);
        };

        const checkCollision = (el1, el2) => {
            const rect1 = el1.getBoundingClientRect();
            const rect2 = el2.getBoundingClientRect();

            return !(rect1.right < rect2.left || 
                     rect1.left > rect2.right || 
                     rect1.bottom < rect2.top || 
                     rect1.top > rect2.bottom);
        };

        const updateScore = () => {
            score += 10;
            uiScore.textContent = score;
            increaseDifficulty();
        };

        const increaseDifficulty = () => {
            if (score % 50 === 0) {
                targetSpeed += 1.5;
                const currentSize = parseInt(window.getComputedStyle(target).width);
                if (currentSize > 40) {
                    target.style.width = `${currentSize - 5}px`;
                    target.style.height = `${currentSize - 5}px`;
                }
            }
        };

        const resetArrow = () => {
            isShooting = false;
            cancelAnimationFrame(animationFrameId);
            arrow.style.left = `${INITIAL_ARROW_LEFT}px`;
        };

        const handleHit = () => {
            updateScore();
            resetArrow();
            target.style.filter = "brightness(1.5)";
            setTimeout(() => target.style.filter = "none", 100);
        };

        const endGame = () => {
            isGameOver = true;
            clearInterval(timerInterval);
            cancelAnimationFrame(targetMovementInterval);
            finalScoreDisplay.textContent = score;
            modal.style.display = 'flex';
        };

        const startGame = () => {
            score = 0;
            timeLeft = 60;
            isGameOver = false;
            targetSpeed = 3;
            
            uiScore.textContent = score;
            uiTime.textContent = timeLeft;
            modal.style.display = 'none';
            
            target.style.width = '100px';
            target.style.height = '100px';
            target.style.top = '50%';
            
            resetArrow();
            startTimer();
            moveTarget();
        };

        gameContainer.addEventListener('click', (e) => {
            if(e.target.tagName !== 'BUTTON') {
                shootArrow();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                shootArrow();
            }
        });

        restartBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            startGame();
        });

        startGame();

    </script>
</body>
</html>